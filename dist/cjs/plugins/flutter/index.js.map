{"version":3,"file":"index.js","names":["setFlutterRxDatabaseConnector","createDB","process","init","databaseName","db","eventBulks$","subscribe","eventBulk","sendRxDBEvent","JSON","stringify","collections","Object","entries","forEach","collectionName","collection","push","name","primaryKey","schema","primaryPath","getLokijsAdapterFlutter","ret","loadDatabase","callback","serializedDb","readKeyValue","success","Error","saveDatabase","dbstring","persistKeyValue"],"sources":["../../../../src/plugins/flutter/index.ts"],"sourcesContent":["import type {\n    RxDatabase\n} from '../../types/index.d.ts';\n\nexport type CreateRxDatabaseFunctionType = (databaseName: string) => Promise<RxDatabase>;\n\nexport function setFlutterRxDatabaseConnector(\n    createDB: CreateRxDatabaseFunctionType\n) {\n    (process as any).init = async (databaseName: string) => {\n        const db = await createDB(databaseName);\n        db.eventBulks$.subscribe(eventBulk => {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            sendRxDBEvent(JSON.stringify(eventBulk));\n        });\n        (process as any).db = db;\n        const collections: { name: string; primaryKey: string; }[] = [];\n        Object.entries(db.collections).forEach(([collectionName, collection]) => {\n            collections.push({\n                name: collectionName,\n                primaryKey: collection.schema.primaryPath\n            });\n        });\n        return {\n            databaseName,\n            collections\n        };\n    };\n}\n\n/**\n * Create a simple lokijs adapter so that we can persist string via flutter\n * @link https://github.com/techfort/LokiJS/blob/master/tutorials/Persistence%20Adapters.md#creating-your-own-basic-persistence-adapter\n */\nexport function getLokijsAdapterFlutter() {\n    const ret = {\n        async loadDatabase(databaseName: string, callback: (v: string | Error) => {}) {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            const serializedDb: string = await readKeyValue(databaseName);\n\n            const success = true;\n            if (success) {\n                callback(serializedDb);\n            } else {\n                callback(new Error('There was a problem loading the database'));\n            }\n        },\n        async saveDatabase(databaseName: string, dbstring: string, callback: (v: string | Error | null) => {}) {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            await persistKeyValue(databaseName, dbstring);\n\n            const success = true;  // make your own determinations\n            if (success) {\n                callback(null);\n            } else {\n                callback(new Error('An error was encountered loading \" + dbname + \" database.'));\n            }\n        }\n    };\n    return ret;\n}\n"],"mappings":";;;;;;;AAMO,SAASA,6BAA6BA,CACzCC,QAAsC,EACxC;EACGC,OAAO,CAASC,IAAI,GAAG,MAAOC,YAAoB,IAAK;IACpD,IAAMC,EAAE,GAAG,MAAMJ,QAAQ,CAACG,YAAY,CAAC;IACvCC,EAAE,CAACC,WAAW,CAACC,SAAS,CAACC,SAAS,IAAI;MAClC;MACA;MACAC,aAAa,CAACC,IAAI,CAACC,SAAS,CAACH,SAAS,CAAC,CAAC;IAC5C,CAAC,CAAC;IACDN,OAAO,CAASG,EAAE,GAAGA,EAAE;IACxB,IAAMO,WAAoD,GAAG,EAAE;IAC/DC,MAAM,CAACC,OAAO,CAACT,EAAE,CAACO,WAAW,CAAC,CAACG,OAAO,CAAC,CAAC,CAACC,cAAc,EAAEC,UAAU,CAAC,KAAK;MACrEL,WAAW,CAACM,IAAI,CAAC;QACbC,IAAI,EAAEH,cAAc;QACpBI,UAAU,EAAEH,UAAU,CAACI,MAAM,CAACC;MAClC,CAAC,CAAC;IACN,CAAC,CAAC;IACF,OAAO;MACHlB,YAAY;MACZQ;IACJ,CAAC;EACL,CAAC;AACL;;AAEA;AACA;AACA;AACA;AACO,SAASW,uBAAuBA,CAAA,EAAG;EACtC,IAAMC,GAAG,GAAG;IACR,MAAMC,YAAYA,CAACrB,YAAoB,EAAEsB,QAAmC,EAAE;MAC1E;MACA;MACA,IAAMC,YAAoB,GAAG,MAAMC,YAAY,CAACxB,YAAY,CAAC;MAE7D,IAAMyB,OAAO,GAAG,IAAI;MACpB,IAAIA,OAAO,EAAE;QACTH,QAAQ,CAACC,YAAY,CAAC;MAC1B,CAAC,MAAM;QACHD,QAAQ,CAAC,IAAII,KAAK,CAAC,0CAA0C,CAAC,CAAC;MACnE;IACJ,CAAC;IACD,MAAMC,YAAYA,CAAC3B,YAAoB,EAAE4B,QAAgB,EAAEN,QAA0C,EAAE;MACnG;MACA;MACA,MAAMO,eAAe,CAAC7B,YAAY,EAAE4B,QAAQ,CAAC;MAE7C,IAAMH,OAAO,GAAG,IAAI,CAAC,CAAE;MACvB,IAAIA,OAAO,EAAE;QACTH,QAAQ,CAAC,IAAI,CAAC;MAClB,CAAC,MAAM;QACHA,QAAQ,CAAC,IAAII,KAAK,CAAC,2DAA2D,CAAC,CAAC;MACpF;IACJ;EACJ,CAAC;EACD,OAAON,GAAG;AACd","ignoreList":[]}