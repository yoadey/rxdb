{"version":3,"file":"index.js","names":["_cleanupHelper","require","_cleanupState","_cleanup","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","RxDBCleanupPlugin","name","rxdb","prototypes","RxCollection","proto","cleanup","minimumDeletedTime","cleanupPolicy","assign","DEFAULT_CLEANUP_POLICY","database","isDone","destroyed","storageInstance","hooks","createRxCollection","after","i","startCleanupForRxCollection","collection","createRxState","startCleanupForRxState","state"],"sources":["../../../../src/plugins/cleanup/index.ts"],"sourcesContent":["import type {\n    RxCollection,\n    RxPlugin\n} from '../../types/index.d.ts';\nimport { DEFAULT_CLEANUP_POLICY } from './cleanup-helper.ts';\nimport { startCleanupForRxState } from './cleanup-state.ts';\nimport { startCleanupForRxCollection } from './cleanup.ts';\n\nexport const RxDBCleanupPlugin: RxPlugin = {\n    name: 'cleanup',\n    rxdb: true,\n    prototypes: {\n        RxCollection: (proto: any) => {\n            proto.cleanup = async function (this: RxCollection, minimumDeletedTime?: number): Promise<void> {\n                const cleanupPolicy = Object.assign(\n                    {},\n                    DEFAULT_CLEANUP_POLICY,\n                    this.database.cleanupPolicy ? this.database.cleanupPolicy : {}\n                );\n\n                if (typeof minimumDeletedTime === 'undefined') {\n                    minimumDeletedTime = cleanupPolicy.minimumDeletedTime;\n                }\n\n                // run cleanup() until it returns true\n                let isDone = false;\n                while (!isDone && !this.destroyed) {\n                    isDone = await this.storageInstance.cleanup(minimumDeletedTime);\n                }\n            };\n        }\n    },\n    hooks: {\n        createRxCollection: {\n            after: (i) => {\n                startCleanupForRxCollection(i.collection);\n            }\n        },\n        createRxState: {\n            after: (i) => {\n                startCleanupForRxState(i.state);\n            }\n        }\n    }\n};\n\nexport * from './cleanup.ts';\n"],"mappings":";;;;;;;;;AAIA,IAAAA,cAAA,GAAAC,OAAA;AACA,IAAAC,aAAA,GAAAD,OAAA;AACA,IAAAE,QAAA,GAAAF,OAAA;AAwCAG,MAAA,CAAAC,IAAA,CAAAF,QAAA,EAAAG,OAAA,WAAAC,GAAA;EAAA,IAAAA,GAAA,kBAAAA,GAAA;EAAA,IAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAC,YAAA,EAAAJ,GAAA;EAAA,IAAAA,GAAA,IAAAK,OAAA,IAAAA,OAAA,CAAAL,GAAA,MAAAJ,QAAA,CAAAI,GAAA;EAAAH,MAAA,CAAAS,cAAA,CAAAD,OAAA,EAAAL,GAAA;IAAAO,UAAA;IAAAC,GAAA,WAAAA,CAAA;MAAA,OAAAZ,QAAA,CAAAI,GAAA;IAAA;EAAA;AAAA;AAtCO,IAAMS,iBAA2B,GAAAJ,OAAA,CAAAI,iBAAA,GAAG;EACvCC,IAAI,EAAE,SAAS;EACfC,IAAI,EAAE,IAAI;EACVC,UAAU,EAAE;IACRC,YAAY,EAAGC,KAAU,IAAK;MAC1BA,KAAK,CAACC,OAAO,GAAG,gBAAoCC,kBAA2B,EAAiB;QAC5F,IAAMC,aAAa,GAAGpB,MAAM,CAACqB,MAAM,CAC/B,CAAC,CAAC,EACFC,qCAAsB,EACtB,IAAI,CAACC,QAAQ,CAACH,aAAa,GAAG,IAAI,CAACG,QAAQ,CAACH,aAAa,GAAG,CAAC,CACjE,CAAC;QAED,IAAI,OAAOD,kBAAkB,KAAK,WAAW,EAAE;UAC3CA,kBAAkB,GAAGC,aAAa,CAACD,kBAAkB;QACzD;;QAEA;QACA,IAAIK,MAAM,GAAG,KAAK;QAClB,OAAO,CAACA,MAAM,IAAI,CAAC,IAAI,CAACC,SAAS,EAAE;UAC/BD,MAAM,GAAG,MAAM,IAAI,CAACE,eAAe,CAACR,OAAO,CAACC,kBAAkB,CAAC;QACnE;MACJ,CAAC;IACL;EACJ,CAAC;EACDQ,KAAK,EAAE;IACHC,kBAAkB,EAAE;MAChBC,KAAK,EAAGC,CAAC,IAAK;QACV,IAAAC,oCAA2B,EAACD,CAAC,CAACE,UAAU,CAAC;MAC7C;IACJ,CAAC;IACDC,aAAa,EAAE;MACXJ,KAAK,EAAGC,CAAC,IAAK;QACV,IAAAI,oCAAsB,EAACJ,CAAC,CAACK,KAAK,CAAC;MACnC;IACJ;EACJ;AACJ,CAAC","ignoreList":[]}