{"version":3,"file":"index.js","names":["_utilsMap","require","_rxState","_helpers","Object","keys","forEach","key","prototype","hasOwnProperty","call","_exportNames","exports","defineProperty","enumerable","get","STATE_BY_DATABASE","WeakMap","addState","namespace","stateCache","getFromMapOrCreate","Map","state","createRxState","states","RxDBStatePlugin","name","rxdb","prototypes","RxDatabase","proto"],"sources":["../../../../src/plugins/state/index.ts"],"sourcesContent":["import type {\n    RxDatabase,\n    RxPlugin,\n    RxState\n} from '../../types/index.d.ts';\nimport { getFromMapOrCreate } from '../utils/utils-map.ts';\nimport { RxStateBase, createRxState } from './rx-state.ts';\n\nexport * from './helpers.ts';\n\ntype StateByPrefix = Map<string, Promise<RxStateBase<any>>>;\nconst STATE_BY_DATABASE = new WeakMap<RxDatabase, StateByPrefix>();\n\nexport async function addState<T>(\n    this: RxDatabase,\n    namespace: string = ''\n): Promise<RxState<T>> {\n    const stateCache = getFromMapOrCreate<RxDatabase, StateByPrefix>(\n        STATE_BY_DATABASE,\n        this,\n        () => new Map()\n    );\n    const state = await getFromMapOrCreate(\n        stateCache,\n        namespace,\n        () => createRxState<T>(this, namespace)\n    );\n    this.states[namespace] = state;\n    return state as any;\n}\n\nexport const RxDBStatePlugin: RxPlugin = {\n    name: 'state',\n    rxdb: true,\n    prototypes: {\n        RxDatabase(proto: any) {\n            proto.addState = addState;\n        }\n    }\n};\n"],"mappings":";;;;;;;;;;;AAKA,IAAAA,SAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AAEA,IAAAE,QAAA,GAAAF,OAAA;AAAAG,MAAA,CAAAC,IAAA,CAAAF,QAAA,EAAAG,OAAA,WAAAC,GAAA;EAAA,IAAAA,GAAA,kBAAAA,GAAA;EAAA,IAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAC,YAAA,EAAAJ,GAAA;EAAA,IAAAA,GAAA,IAAAK,OAAA,IAAAA,OAAA,CAAAL,GAAA,MAAAJ,QAAA,CAAAI,GAAA;EAAAH,MAAA,CAAAS,cAAA,CAAAD,OAAA,EAAAL,GAAA;IAAAO,UAAA;IAAAC,GAAA,WAAAA,CAAA;MAAA,OAAAZ,QAAA,CAAAI,GAAA;IAAA;EAAA;AAAA;AAGA,IAAMS,iBAAiB,GAAG,IAAIC,OAAO,CAA4B,CAAC;AAE3D,eAAeC,QAAQA,CAE1BC,SAAiB,GAAG,EAAE,EACH;EACnB,IAAMC,UAAU,GAAG,IAAAC,4BAAkB,EACjCL,iBAAiB,EACjB,IAAI,EACJ,MAAM,IAAIM,GAAG,CAAC,CAClB,CAAC;EACD,IAAMC,KAAK,GAAG,MAAM,IAAAF,4BAAkB,EAClCD,UAAU,EACVD,SAAS,EACT,MAAM,IAAAK,sBAAa,EAAI,IAAI,EAAEL,SAAS,CAC1C,CAAC;EACD,IAAI,CAACM,MAAM,CAACN,SAAS,CAAC,GAAGI,KAAK;EAC9B,OAAOA,KAAK;AAChB;AAEO,IAAMG,eAAyB,GAAAd,OAAA,CAAAc,eAAA,GAAG;EACrCC,IAAI,EAAE,OAAO;EACbC,IAAI,EAAE,IAAI;EACVC,UAAU,EAAE;IACRC,UAAUA,CAACC,KAAU,EAAE;MACnBA,KAAK,CAACb,QAAQ,GAAGA,QAAQ;IAC7B;EACJ;AACJ,CAAC","ignoreList":[]}