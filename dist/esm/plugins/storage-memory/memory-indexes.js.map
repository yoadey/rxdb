{"version":3,"file":"memory-indexes.js","names":["getIndexableStringMonad","getPrimaryFieldOfPrimaryKey","toArray","addIndexesToInternalsState","state","schema","primaryPath","primaryKey","useIndexes","indexes","map","row","push","forEach","indexAr","byIndex","getMemoryIndexName","index","docsWithIndex","getIndexableString","join"],"sources":["../../../../src/plugins/storage-memory/memory-indexes.ts"],"sourcesContent":["import { getIndexableStringMonad } from '../../custom-index.ts';\nimport { getPrimaryFieldOfPrimaryKey } from '../../rx-schema-helper.ts';\nimport type { RxDocumentData, RxJsonSchema } from '../../types/index.d.ts';\nimport { toArray } from '../../plugins/utils/index.ts';\nimport type { MemoryStorageInternals } from './memory-types.ts';\n\nexport function addIndexesToInternalsState<RxDocType>(\n    state: MemoryStorageInternals<RxDocType>,\n    schema: RxJsonSchema<RxDocumentData<RxDocType>>\n) {\n    const primaryPath = getPrimaryFieldOfPrimaryKey(schema.primaryKey);\n    const useIndexes: string[][] = !schema.indexes ? [] : schema.indexes.map(row => toArray(row)) as any;\n\n    // we need this index for running cleanup()\n    useIndexes.push([\n        '_deleted',\n        '_meta.lwt',\n        primaryPath\n    ]);\n\n\n    useIndexes.forEach(indexAr => {\n        state.byIndex[getMemoryIndexName(indexAr)] = {\n            index: indexAr,\n            docsWithIndex: [],\n            getIndexableString: getIndexableStringMonad(schema, indexAr)\n        };\n    });\n}\n\n\nexport function getMemoryIndexName(index: string[]): string {\n    return index.join(',');\n}\n"],"mappings":"AAAA,SAASA,uBAAuB,QAAQ,uBAAuB;AAC/D,SAASC,2BAA2B,QAAQ,2BAA2B;AAEvE,SAASC,OAAO,QAAQ,8BAA8B;AAGtD,OAAO,SAASC,0BAA0BA,CACtCC,KAAwC,EACxCC,MAA+C,EACjD;EACE,IAAMC,WAAW,GAAGL,2BAA2B,CAACI,MAAM,CAACE,UAAU,CAAC;EAClE,IAAMC,UAAsB,GAAG,CAACH,MAAM,CAACI,OAAO,GAAG,EAAE,GAAGJ,MAAM,CAACI,OAAO,CAACC,GAAG,CAACC,GAAG,IAAIT,OAAO,CAACS,GAAG,CAAC,CAAQ;;EAEpG;EACAH,UAAU,CAACI,IAAI,CAAC,CACZ,UAAU,EACV,WAAW,EACXN,WAAW,CACd,CAAC;EAGFE,UAAU,CAACK,OAAO,CAACC,OAAO,IAAI;IAC1BV,KAAK,CAACW,OAAO,CAACC,kBAAkB,CAACF,OAAO,CAAC,CAAC,GAAG;MACzCG,KAAK,EAAEH,OAAO;MACdI,aAAa,EAAE,EAAE;MACjBC,kBAAkB,EAAEnB,uBAAuB,CAACK,MAAM,EAAES,OAAO;IAC/D,CAAC;EACL,CAAC,CAAC;AACN;AAGA,OAAO,SAASE,kBAAkBA,CAACC,KAAe,EAAU;EACxD,OAAOA,KAAK,CAACG,IAAI,CAAC,GAAG,CAAC;AAC1B","ignoreList":[]}