{"version":3,"file":"crdt.d.js","names":[],"sources":["../../../../src/types/plugins/crdt.d.ts"],"sourcesContent":["import type { MangoQuerySelector } from '../rx-query.d.ts';\nimport type { StringKeys } from '../util.d.ts';\nimport type { UpdateQuery } from './update.d.ts';\n\n\nexport type CRDTEntry<RxDocType> = {\n    selector?: MangoQuerySelector<RxDocType>;\n    ifMatch?: UpdateQuery<RxDocType>;\n    ifNotMatch?: UpdateQuery<RxDocType>;\n};\n\n/**\n * Options for the crdt plugin.\n * We set these in the schema because changing them\n * is not possible on the fly because it would\n * destroy the document state in an unpredictable way.\n */\nexport type CRDTSchemaOptions<RxDocType> = {\n    /**\n     * Determines which field of the document must be used\n     * to store the crdt operations.\n     * The given field must exist with the content of \"CRDT_FIELD_SCHEMA\" in the\n     * properties part of your schema.\n     */\n    field: StringKeys<RxDocType> | string;\n\n    /**\n     * After BOTH of the limits\n     * maxOperations/maxTTL is reached,\n     * the document will clean up the stored operations\n     * and merged them together to ensure\n     * that not too many operations are stored which could slow down the\n     * database operations.\n     */\n    // TODO not implemented yet, make a pull request if you need that.\n    // maxOperations: number;\n    // maxTTL: number;\n};\n\n\nexport type CRDTOperation<RxDocType> = {\n    body: CRDTEntry<RxDocType>[];\n    /**\n     * A string to uniquely represent the creator\n     * of this operation.\n     * Mostly you would use the RxDatabase().storageToken().\n     */\n    creator: string;\n\n    /**\n     * Unix time in milliseconds\n     * that determines when the operation was created.\n     * Used to properly clean up old operations.\n     */\n    time: number;\n};\n\n\nexport type CRDTDocumentField<RxDocType> = {\n    /**\n     * An array with arrays of CRDT operations.\n     * The index of the top level array is equal\n     * to the revision height where the operations\n     * belong to.\n     * Sorted by revision height ascending.\n     * If we have a conflict and we need a rebuild,\n     * the operations will be run in the revision height\n     * sort order to make everything deterministic.\n     */\n    operations: CRDTOperation<RxDocType>[][];\n\n    /**\n     * A hash to uniquely define the whole operations state.\n     */\n    hash: string;\n};\n"],"mappings":"","ignoreList":[]}