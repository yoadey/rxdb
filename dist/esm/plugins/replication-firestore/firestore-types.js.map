{"version":3,"file":"firestore-types.js","names":[],"sources":["../../../../src/plugins/replication-firestore/firestore-types.ts"],"sourcesContent":["import type {\n    MaybePromise,\n    ReplicationOptions,\n    ReplicationPullOptions,\n    ReplicationPushOptions,\n    WithDeleted\n} from '../../types/index.d.ts';\n\nimport type {\n    CollectionReference,\n    Firestore,\n    QueryFieldFilterConstraint,\n    QuerySnapshot\n} from 'firebase/firestore';\n\nexport type FirestoreCheckpointType = {\n    id: string;\n    /**\n     * Firestore internally sets the time to an object like\n     * {\n     *       \"seconds\": 1669807105,\n     *       \"nanoseconds\": 476000000\n     * }\n     * But to be able to query that, we have to use a date string\n     * like '2022-11-30T11:18:25.141Z'\n     * so we store that string instead.\n     */\n    serverTimestamp: string;\n};\nexport type FirestoreCollection<RxDocType> = CollectionReference<RxDocType>;\n\nexport type FirestoreOptions<RxDocType> = {\n    projectId: string;\n    collection: FirestoreCollection<RxDocType>;\n    database: Firestore;\n};\n\nexport type FirestoreSyncPullOptions<RxDocType> =\n    Omit<ReplicationPullOptions<RxDocType, FirestoreCheckpointType>, 'handler' | 'stream$'>\n    & {\n        filter?: QueryFieldFilterConstraint | QueryFieldFilterConstraint[];\n    };\n\nexport type FirestoreSyncPushOptions<RxDocType> = Omit<ReplicationPushOptions<RxDocType>, 'handler'>\n    & {\n        filter?(item: WithDeleted<RxDocType>): MaybePromise<boolean>;\n    };\n\nexport type SyncOptionsFirestore<RxDocType> = Omit<\n    ReplicationOptions<RxDocType, any>,\n    'pull' | 'push'\n> & {\n    firestore: FirestoreOptions<RxDocType>;\n    /**\n     * In firestore it is not possible to read out\n     * the internally used write timestamp.\n     * Even if we could read it out, it is not indexed which\n     * is required for fetch 'changes-since-x'.\n     * So instead we have to rely on a custom user defined field\n     * that contains the server time which is set by firestore via serverTimestamp()\n     * IMPORTANT: The serverTimestampField MUST NOT be part of the collections RxJsonSchema!\n     * [default='serverTimestamp']\n     * @link https://groups.google.com/g/firebase-talk/c/tAmPzPei-mE\n     */\n    serverTimestampField?: string;\n    pull?: FirestoreSyncPullOptions<RxDocType>;\n    push?: FirestoreSyncPushOptions<RxDocType>;\n};\n\nexport type GetQuery<RxDocType> = (ids: string[]) => Promise<QuerySnapshot<RxDocType>>;\n"],"mappings":"","ignoreList":[]}