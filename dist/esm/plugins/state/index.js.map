{"version":3,"file":"index.js","names":["getFromMapOrCreate","createRxState","STATE_BY_DATABASE","WeakMap","addState","namespace","stateCache","Map","state","states","RxDBStatePlugin","name","rxdb","prototypes","RxDatabase","proto"],"sources":["../../../../src/plugins/state/index.ts"],"sourcesContent":["import type {\n    RxDatabase,\n    RxPlugin,\n    RxState\n} from '../../types/index.d.ts';\nimport { getFromMapOrCreate } from '../utils/utils-map.ts';\nimport { RxStateBase, createRxState } from './rx-state.ts';\n\nexport * from './helpers.ts';\n\ntype StateByPrefix = Map<string, Promise<RxStateBase<any>>>;\nconst STATE_BY_DATABASE = new WeakMap<RxDatabase, StateByPrefix>();\n\nexport async function addState<T>(\n    this: RxDatabase,\n    namespace: string = ''\n): Promise<RxState<T>> {\n    const stateCache = getFromMapOrCreate<RxDatabase, StateByPrefix>(\n        STATE_BY_DATABASE,\n        this,\n        () => new Map()\n    );\n    const state = await getFromMapOrCreate(\n        stateCache,\n        namespace,\n        () => createRxState<T>(this, namespace)\n    );\n    this.states[namespace] = state;\n    return state as any;\n}\n\nexport const RxDBStatePlugin: RxPlugin = {\n    name: 'state',\n    rxdb: true,\n    prototypes: {\n        RxDatabase(proto: any) {\n            proto.addState = addState;\n        }\n    }\n};\n"],"mappings":"AAKA,SAASA,kBAAkB,QAAQ,uBAAuB;AAC1D,SAAsBC,aAAa,QAAQ,eAAe;AAE1D,cAAc,cAAc;AAG5B,IAAMC,iBAAiB,GAAG,IAAIC,OAAO,CAA4B,CAAC;AAElE,OAAO,eAAeC,QAAQA,CAE1BC,SAAiB,GAAG,EAAE,EACH;EACnB,IAAMC,UAAU,GAAGN,kBAAkB,CACjCE,iBAAiB,EACjB,IAAI,EACJ,MAAM,IAAIK,GAAG,CAAC,CAClB,CAAC;EACD,IAAMC,KAAK,GAAG,MAAMR,kBAAkB,CAClCM,UAAU,EACVD,SAAS,EACT,MAAMJ,aAAa,CAAI,IAAI,EAAEI,SAAS,CAC1C,CAAC;EACD,IAAI,CAACI,MAAM,CAACJ,SAAS,CAAC,GAAGG,KAAK;EAC9B,OAAOA,KAAK;AAChB;AAEA,OAAO,IAAME,eAAyB,GAAG;EACrCC,IAAI,EAAE,OAAO;EACbC,IAAI,EAAE,IAAI;EACVC,UAAU,EAAE;IACRC,UAAUA,CAACC,KAAU,EAAE;MACnBA,KAAK,CAACX,QAAQ,GAAGA,QAAQ;IAC7B;EACJ;AACJ,CAAC","ignoreList":[]}